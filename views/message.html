<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>留言</title>
    <link rel="stylesheet" href="/node_modules/bootstrap/dist/css/bootstrap.css">
    <link rel="stylesheet" href="/public/css/message.css">
    <!-- HTML5 shim 和 Respond.js 是为了让 IE8 支持 HTML5 元素和媒体查询（media queries）功能 -->
    <!-- 警告：通过 file:// 协议（就是直接将 html 页面拖拽到浏览器中）访问页面时 Respond.js 不起作用 -->
    <!--[if lt IE 9]>
      <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
    <![endif]-->
</head>

<body>
    <div class="webBanner container-fluid">
        <div class="bannerImg col-sm-12">

        </div>
    </div>
    <div class="webTable">
        <div class="container">
            <div class="myliuyan">
                <div class="row liuyanHead">
                    <p class="text-center titleP"><span class="mainTitle">留言板</span></p>
                    <p class="text-center"><span class="subTitleText">Message</span></p>
                    <p class="text-center hint"></p>
                </div>
                <div class="row">
                    <p class="fabiao">发表您的留言：</p>
                    <div class="row">
                        <div class="col-sm-4 input-liuyan">
                            <div class="input-group">
                                <span class="input-group-addon" id="basic-addon1">姓名：</span>
                                <input name="name" type="text" class="form-control" placeholder="">
                            </div>
                        </div>
                        <div class="col-sm-4 input-liuyan">
                            <div class="input-group">
                                <span class="input-group-addon" id="basic-addon2">邮箱：</span>
                                <input name="email" type="text" class="form-control" placeholder="">
                            </div>
                        </div>
                        <div class="col-sm-4 input-liuyan">
                            <div class="input-group">
                                <span class="input-group-addon" id="basic-addon3">电话：</span>
                                <input name="phone" type="text" class="form-control" placeholder="">
                            </div>
                        </div>
                        <div class="col-xs-6 col-md-5 input-textarea">
                            <label for="liuyan">留言：</label>
                            <textarea id="liuyan" class="form-control" rows="3" placeholder="留言需审核后才会显示"></textarea>
                        </div>

                    </div>
                    <div class="row">
                        <div class="">
                            <button id="postMessage" class="btn btn-info col-xs-2 col-xs-offset-1" type="button"
                                data-toggle="#myModal" data-target=".bs-example-modal-sm">提交留言</button>
                        </div>
                    </div>
                </div>
                <div class="row showMessage">
                    <p>留言：<span id="show"></span></p>
                    <div></div>
                </div>
            </div>
        </div>

        <!-- 模态框 -->
        <div id="myModal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel">
            <div class="modal-dialog modal-sm" role="document">
                <div class="modal-content content">
                    <p><span class="glyphicon glyphicon-ok-sign myicon"></span> 留言成功！请等待管理员联系</p>
                </div>
            </div>
        </div>


        <script src="/node_modules/jquery/dist/jquery.js"></script>
        <script src="/node_modules/bootstrap/dist/js/bootstrap.js"></script>

        <script>
            $(function () {
                $("#postMessage").click(function () {
                    $(".hint").text("")
                    var name = $("input[name='name']").val()
                    var email = $("input[name='email']").val()
                    var phone = $("input[name='phone']").val()
                    var liuyan = $("#liuyan").val()
                    var emailReg = /^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/;
                    var phoneReg = /^1(3[0-9]|4[01456879]|5[0-35-9]|6[2567]|7[0-8]|8[0-9]|9[0-35-9])\d{8}$/;
                    if (name === "") {
                        $(".hint").text("请输入姓名！")
                        $("input[name='name']").focus()
                        return;
                    }
                    if (email === "") {
                        $(".hint").text("请输入邮箱！")
                        $("input[name='email']").focus()
                        return;
                    }
                    else if (!emailReg.test(email)) {
                        $(".hint").text("请输入正确邮箱！")
                        $("input[name='email']").focus()
                        return;
                    }
                    if (phone === "") {
                        $(".hint").text("请输入电话！")
                        $("input[name='phone']").focus()
                        return;
                    }
                    else if (!phoneReg.test(phone)) {
                        $(".hint").text("请输入正确电话！")
                        $("input[name='phone']").focus()
                        return;
                    }
                    if (liuyan === "") {
                        $(".hint").text("请输入留言！")
                        $("#liuyan").focus()
                        return;
                    }
                    $.ajax({
                        type: "post",
                        url: "/postMessage",
                        data: { name: name, email: email, phone: phone, message: liuyan },
                        contentType: "application/x-www-form-urlencoded",
                        success: function (data) {
                            $("#myModal").modal("show")
                            var res = data.res
                            var msg = res[0].message
                            console.log(msg, 666)
                            var timer = setTimeout(() => {
                                $(".hint").text("")
                                $("#myModal").modal("hide")
                                $("#show").text(msg)
                                clearTimeout(timer)
                            }, 1500)

                        },
                    });
                })
            })
        </script>
</body>

</html>