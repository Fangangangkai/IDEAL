{{extend './layout/layout.html'}}
{{block "head"}}
<title>在线留言</title>
<!-- <style src="../public/css/message.css"></style> -->
<style>
    p {
        margin: 0;
        padding: 0;
    }

    .webBanner {
        height: 300px;
        padding: 0;
        margin: 0 auto;
        overflow: hidden;
    }

    .webBanner .bannerImg {
        width: 100%;
        height: 300px;
        background-image: url(../public/img/message_1.jpg);
        background-size: cover;
        background-position: 50% 50%;
        background-repeat: no-repeat;
    }

    .webTable {
        margin-top: 8px;
    }

    .webTable .myliuyan {
        padding-left: 20px;
        padding-right: 20px;
    }

    .webTable .myliuyan .liuyanHead {
        padding-top: 25px;
        padding-bottom: 25px;
    }

    .webTable .myliuyan .liuyanHead .titleP {
        margin-bottom: 5px;
    }

    .webTable .myliuyan .liuyanHead .titleP .mainTitle {
        font-size: 26px;
        color: #444444;
    }

    .webTable .myliuyan .liuyanHead .subTitleText {
        color: #737373;
        font-size: 16px;
        padding: 0 10px;
        position: relative;
    }

    .webTable .myliuyan .liuyanHead .subTitleText::before {
        content: "";
        position: absolute;
        display: block;
        width: 50px;
        height: 1px;
        background: #737373;
        left: -50px;
        top: 50%;
    }

    .webTable .myliuyan .liuyanHead .subTitleText::after {
        content: "";
        position: absolute;
        display: block;
        width: 50px;
        height: 1px;
        background: #737373;
        right: -50px;
        top: 50%;
    }

    .webTable .myliuyan .liuyanHead .hint {
        color: red;
        padding-top: 20px;
    }

    .webTable .myliuyan .fabiao {
        margin-top: 10px;
        margin-bottom: 15px;
    }

    .webTable .myliuyan .input-liuyan {
        margin-top: 10px;
        margin-bottom: 10px;
    }

    .webTable .myliuyan .input-textarea {
        margin-top: 10px;
        margin-bottom: 15px;
    }

    .webTable .myliuyan .showMessage {
        padding-top: 35px;
    }

    .webTable .myliuyan .showMessage>p {
        height: 34px;
        line-height: 34px;
    }

    .webTable .myliuyan .showMessage>div {
        margin-top: 5px;
        height: 35px;
        border-top: 1px dotted #dadada;
    }

    #myModal {
        position: fixed;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
    }

    #myModal .content {
        padding: 20px 20px;
    }

    #myModal .myicon {
        font-size: 20px;
        font-weight: 100;
        color: green;
        vertical-align: middle;
    }

    #myModal>p {
        padding: 30px;
        line-height: 30px;
        font-size: 20px;
    }
</style>
{{/block}}

{{block "content"}}
<div class="webBanner container-fluid">
    <div class="bannerImg col-sm-12">

    </div>
</div>
<div class="webTable">
    <div class="container">
        <div class="myliuyan">
            <div class="row liuyanHead">
                <p class="text-center titleP"><span class="mainTitle">留言板</span></p>
                <p class="text-center"><span class="subTitleText">Message</span></p>
                <p class="text-center hint"></p>
            </div>
            <div class="row">
                <form action="message" method="post">
                    <p class="fabiao">发表您的留言：</p>
                    <div class="row">
                        <div class="col-sm-4 input-liuyan">
                            <div class="input-group">
                                <span class="input-group-addon" id="basic-addon1">姓名：</span>
                                <input name="name" type="text" class="form-control" placeholder="">
                            </div>
                        </div>
                        <div class="col-sm-4 input-liuyan">
                            <div class="input-group">
                                <span class="input-group-addon" id="basic-addon2">邮箱：</span>
                                <input name="email" type="text" class="form-control" placeholder="">
                            </div>
                        </div>
                        <div class="col-sm-4 input-liuyan">
                            <div class="input-group">
                                <span class="input-group-addon" id="basic-addon3">电话：</span>
                                <input name="phone" type="text" class="form-control" placeholder="">
                            </div>
                        </div>
                        <div class="col-xs-6 col-md-5 input-textarea">
                            <label for="liuyan">留言：</label>
                            <textarea id="liuyan" name="liuyan" class="form-control" rows="3"
                                placeholder="留言需审核后才会显示"></textarea>
                        </div>
                    </div>
                    <div class="row">
                        <!-- <div class=""> -->
                        <button id="postMessage" class="btn btn-info col-xs-2 col-xs-offset-1" type="submit"
                            data-toggle="#myModal" data-target=".bs-example-modal-sm">提交留言</button>
                        <!-- </div> -->
                    </div>
                </form>
            </div>
            <div class="row showMessage">
                <p>留言：<span id="show"></span></p>

                <table class="table">
                    <thead>
                        <tr>
                            <th>姓名</th>
                            <th>留言内容</th>
                            <th>时间</th>
                        </tr>
                    </thead>
                    <tbody>
                        {{each mess}}
                        <tr>
                            <td>{{$value.name}}</td>
                            <td>{{$value.email}}</td>
                            <td>{{$value.created_time}}</td>
                        </tr>
                        {{/each}}
                    </tbody>
                </table>
                <!-- {{mess}} -->
                <p class="line"></p>
                <!-- <div class="nomessage">暂无留言</div> -->
            </div>
        </div>
    </div>

    <!-- 模态框 -->
    <div id="myModal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel">
        <div class="modal-dialog modal-sm" role="document">
            <div class="modal-content content">
                <p><span class="glyphicon glyphicon-ok-sign myicon"></span> 留言成功！请等待管理员联系</p>
            </div>
        </div>
    </div>
</div>

{{/block}}

{{block "script"}}
<script>
    $(function () {
        $("#postMessage").click(function () {
            $(".hint").text("")
            var name = $("input[name='name']").val()
            var email = $("input[name='email']").val()
            var phone = $("input[name='phone']").val()
            var liuyan = $("#liuyan").val()
            var emailReg = /^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/;
            var phoneReg = /^1(3[0-9]|4[01456879]|5[0-35-9]|6[2567]|7[0-8]|8[0-9]|9[0-35-9])\d{8}$/;
            if (name === "") {
                $(".hint").text("请输入姓名！")
                $("input[name='name']").focus()
                return;
            }
            if (email === "") {
                $(".hint").text("请输入邮箱！")
                $("input[name='email']").focus()
                return;
            }
            else if (!emailReg.test(email)) {
                $(".hint").text("请输入正确邮箱！")
                $("input[name='email']").focus()
                return;
            }
            if (phone === "") {
                $(".hint").text("请输入电话！")
                $("input[name='phone']").focus()
                return;
            }
            else if (!phoneReg.test(phone)) {
                $(".hint").text("请输入正确电话！")
                $("input[name='phone']").focus()
                return;
            }
            if (liuyan === "") {
                $(".hint").text("请输入留言！")
                $("#liuyan").focus()
                return;
            }
            $.ajax({
                type: "post",
                url: "/postMessage",
                data: { name: name, email: email, phone: phone, message: liuyan },
                contentType: "application/x-www-form-urlencoded",
                success: function (data) {
                    $("#myModal").modal("show")
                    var res = data.res
                    var msg = res[0].message
                    console.log(msg, 666)
                    var timer = setTimeout(() => {
                        $(".hint").text("")
                        $("#myModal").modal("hide")
                        $("#show").text(msg)
                        clearTimeout(timer)
                    }, 1500)
                },
            });
        })
    })
</script>
{{/block}}